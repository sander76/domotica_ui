<!doctype html>
<html>

<head>

    <title>Duomo</title>
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <link rel="manifest" href="manifest.json">
    <script src="../bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
    <!--    <script src="../bower_components/webcomponentsjs/webcomponents.min.js"></script>-->
    <!--    <script src="../bower_components/page.js/page.js"></script>-->
    <script src="../bower_components/page/page.js"></script>
    <link rel="import" href="imports.html">
    <link rel="stylesheet" href="styles.css">

</head>

<body unresolved class="fullbleed layout vertical">
    <template is="dom-bind" id="app">
        <iron-ajax auto url="structure.json" handle-as="json" on-response="handle_json"></iron-ajax>

        <paper-drawer-panel id="drawerPanel" responsive-width="1280px">
            <div drawer>
                <paper-toolbar id="drawerToolbar">
                    <span>Menu</span>
                </paper-toolbar>
                <paper-menu class="list" attr-for-selected="hash" on-iron-select="onMenuSelect" selected="{{route}}">
                    <paper-item>
                        <a hash="lights" href="/lights">
                            <iron-icon icon="home">
                            </iron-icon>
                            <span>Lights</span>
                        </a>
                    </paper-item>
                    <paper-item>
                        <a hash="connection" href="/connection">
                            <iron-icon icon="info"></iron-icon>
                            <span>Connection</span>
                        </a>
                    </paper-item>

                </paper-menu>
            </div>


            <paper-header-panel class="main" main mode="waterfall">
                <paper-toolbar>
                    <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
                    <span tool flex>Duomo</span>

                </paper-toolbar>

                <div class="content">
                    <iron-pages attr-for-selected="hash" selected="{{route}}">
                        <section hash="lights">

                            <mqtt-parent topics="{{topics}}"></mqtt-parent>

                        </section>

                        <section hash="connection">
                            <mqtt-service id="mqttserv" host="192.168.2.14" topics="{{topics}}" client="test.mosquitto.org" port="9001" debug="true"></mqtt-service>
                        </section>
                    </iron-pages>

                </div>
            </paper-header-panel>
        </paper-drawer-panel>
    </template>
    <script>
        (function (document) {
            'use strict';
            var app = document.querySelector("#app");

            app.topics = [{
                    pub: "room/lights/1",
                    sub: ["room/lights/1", "room/lights/all"],
                    name: "light 1",
                    ui_type: "toggle"
            }
        ,
                {
                    sub: ["room/temperatures/1"],
                    name: "temp 1",
                    ui_type: "display"
            }];

            app.handle_json = function (data) {
                app.topics = data.detail.response.ui;
            };
            app.onMenuSelect = function () {
                //                    var drawerPanel = document.querySelector('#paperDrawerPanel');
                //                    if (drawerPanel.narrow) {
                //                        drawerPanel.closeDrawer();
                //                    }
            };
            window.onfocus = function () {
                    var mqtt_service = document.querySelector('#mqttserv');
                    console.log("got focus");
                }
                //define routing
                //                page('/', lights);
                //                page('/connection', other);
                //
                //                function lights() {
                //                    app.route = 'lights';
                //                }
                //
                //                function other() {
                //                    app.route = 'connection';
                //                }
                //
                //                page({
                //                    hashbang: true
                //                });
        })(document);
    </script>
</body>

</html>